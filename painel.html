<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Operacional Log√≠stico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:'Segoe UI',Arial,sans-serif;
  background:#f1f5f9;
}

/* HEADER */
header{
  background:linear-gradient(90deg,#1e3a8a,#dc2626);
  color:#fff;
  padding:25px;
  text-align:center;
  position:relative;
}

.logout-btn{
  position:absolute;
  right:20px;
  top:20px;
  background:#dc2626;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}

/* MAIN */
main{
  padding:40px;
  max-width:1200px;
  margin:auto;
}

/* GRID */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
  opacity:0;
  transform:translateY(15px);
  transition:all .6s ease;
}

.cards.loaded{
  opacity:1;
  transform:translateY(0);
}

/* CARD */
.card{
  background:#fff;
  border-radius:14px;
  padding:25px;
  text-align:center;
  text-decoration:none;
  color:#1f2937;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  transition:all .3s ease;
  position:relative;
}

.card:hover{
  transform:translateY(-6px);
  box-shadow:0 12px 28px rgba(0,0,0,0.15);
}

.icon{font-size:40px;margin-bottom:12px;}
.title{font-size:17px;font-weight:600;margin-bottom:8px;}
.desc{font-size:13px;color:#64748b;}

footer{
  text-align:center;
  padding:20px;
  font-size:12px;
  color:#64748b;
}

/* ================= KPI DASHBOARD ================= */

.kpi-container{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:40px;
}

.kpi-card{
  background:#ffffff;
  border-radius:16px;
  padding:25px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  display:flex;
  align-items:center;
  justify-content:space-between;
  transition:.3s;
}

.kpi-card:hover{
  transform:translateY(-4px);
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
}

.kpi-title{
  font-size:13px;
  color:#64748b;
  margin-bottom:6px;
}

.kpi-number{
  font-size:28px;
  font-weight:700;
  color:#1e293b;
}

.kpi-icon{
  width:55px;
  height:55px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  color:#fff;
}

.bg-green{background:#16a34a;}
.bg-blue{background:#1e3a8a;}
.bg-orange{background:#ea580c;}
.bg-red{background:#dc2626;}

.skeleton{
  background:linear-gradient(90deg,#e2e8f0 25%,#f1f5f9 50%,#e2e8f0 75%);
  background-size:200% 100%;
  animation:loading 1.2s infinite;
  border-radius:14px;
  height:140px;
}

@keyframes loading{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}
</style>
</head>

<body>

<header>
<button class="logout-btn" onclick="logout()">Sair</button>
<h1>üöö Painel Operacional Log√≠stico</h1>
<p>Central unificada da Frota</p>
<p id="usuarioLogado" style="margin-top:8px;font-size:13px;opacity:.9;"></p>
</header>

<main>

<!-- KPI -->
<div class="kpi-container" id="kpiContainer" style="display:none;">

  <div class="kpi-card">
    <div>
      <div class="kpi-title">Total Caminh√µes</div>
      <div class="kpi-number" id="kpiCaminhoes">0</div>
    </div>
    <div class="kpi-icon bg-green">üöõ</div>
  </div>

  <div class="kpi-card">
    <div>
      <div class="kpi-title">Dispon√≠veis</div>
      <div class="kpi-number" id="kpiDisponiveis">0</div>
    </div>
    <div class="kpi-icon bg-blue">üü¢</div>
  </div>

  <div class="kpi-card">
    <div>
      <div class="kpi-title">Na Fila</div>
      <div class="kpi-number" id="kpiFila">0</div>
    </div>
    <div class="kpi-icon bg-orange">üïí</div>
  </div>

  <div class="kpi-card">
    <div>
      <div class="kpi-title">Em Atendimento</div>
      <div class="kpi-number" id="kpiAtendimento">0</div>
    </div>
    <div class="kpi-icon bg-red">üöß</div>
  </div>

</div>

<!-- SKELETON -->
<div id="skeletonContainer" class="cards">
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
</div>

<!-- CARDS -->
<div class="cards" id="cardsContainer" style="display:none;">

<a class="card" href="index.html" id="cardPainelFila" style="display:none;">
  <div class="icon">üéõÔ∏è</div>
  <div class="title">Painel da Fila</div>
</a>

<a class="card" href="motoristas.html" id="cardDisponibilidade" style="display:none;">
  <div class="icon">üìç</div>
  <div class="title">Disponibilidade</div>
</a>

<a href="motoristas-admin.html" 
   class="card"
   id="cardMotoristasAdmin"
   style="display:none;">
  <div class="icon">üë§</div>
  <div class="title">Motoristas Admin</div>
</a>

<a class="card" href="frete.html" id="cardFrete" style="display:none;">
  <div class="icon">üßÆ</div>
  <div class="title">C√°lculo de Frete</div>
</a>

</div>

</main>

<footer>
2026 ¬∑ Sistema Operacional Log√≠stico - ¬© Renato Monteiro
</footer>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyCKdfOvWehaJcuK6uX5JXxc7YdN26h8sXY",
  authDomain:"tabela-frete-rio-branco.firebaseapp.com",
  projectId:"tabela-frete-rio-branco"
});

const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user)=>{

  if(!user){ window.location.href="login.html"; return; }

  const snap = await getDoc(doc(db,"usuarios",user.uid));
  if(!snap.exists()){ window.location.href="login.html"; return; }

  const dados = snap.data();

  document.getElementById("usuarioLogado").innerText =
    "Usu√°rio: "+dados.nome+" ("+dados.perfil.toUpperCase()+")";

  if(dados.perfil === "admin"){
    document.querySelectorAll("#cardsContainer .card").forEach(c=>{
      c.style.display="block";
    });
    await carregarKPIs();
  }else{
    if(dados.menus?.painel)
      document.getElementById("cardPainelFila").style.display="block";

    if(dados.menus?.frete)
      document.getElementById("cardFrete").style.display="block";
  }

  document.getElementById("skeletonContainer").style.display="none";
  const cards=document.getElementById("cardsContainer");
  cards.style.display="grid";
  setTimeout(()=>cards.classList.add("loaded"),50);
});

async function carregarKPIs(){

  const motoristasSnap = await getDocs(collection(db,"motoristas"));
  const filaSnap = await getDocs(collection(db,"fila"));

  let total = motoristasSnap.size;
  let disponiveis = 0;
  let atendimento = 0;

  motoristasSnap.forEach(doc=>{
    const d = doc.data();
    if(d.status === "DISPON√çVEL") disponiveis++;
    if(d.status === "EM_ATENDIMENTO") atendimento++;
  });

  document.getElementById("kpiCaminhoes").innerText = total;
  document.getElementById("kpiDisponiveis").innerText = disponiveis;
  document.getElementById("kpiFila").innerText = filaSnap.size;
  document.getElementById("kpiAtendimento").innerText = atendimento;

  document.getElementById("kpiContainer").style.display="grid";
}

window.logout=()=>signOut(auth).then(()=>window.location.href="login.html");

</script>

</body>
</html>

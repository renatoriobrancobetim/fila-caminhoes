<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Operacional Log√≠stico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f1f5f9;
}

/* HEADER */
header{
  background:linear-gradient(90deg,#1e3a8a,#dc2626);
  color:#fff;
  padding:25px;
  text-align:center;
  position:relative;
}

.logout-btn{
  position:absolute;
  right:20px;
  top:20px;
  background:#dc2626;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}

/* MAIN */
main{
  padding:40px;
  max-width:1200px;
  margin:auto;
}

/* GRID */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
  opacity:0;
  transform:translateY(15px);
  transition:all .6s ease;
}

.cards.loaded{
  opacity:1;
  transform:translateY(0);
}

/* CARD */
.card{
  background:#fff;
  border-radius:14px;
  padding:25px;
  text-align:center;
  text-decoration:none;
  color:#1f2937;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  transition:all .3s ease;
  position:relative;
}

.card:hover{
  transform:translateY(-6px);
  box-shadow:0 12px 28px rgba(0,0,0,0.15);
}

.icon{
  font-size:40px;
  margin-bottom:12px;
}

.title{
  font-size:17px;
  font-weight:600;
  margin-bottom:8px;
}

.desc{
  font-size:13px;
  color:#64748b;
}

/* BADGE */
.badge-alerta{
  position:absolute;
  top:15px;
  right:15px;
  background:#dc2626;
  color:#fff;
  font-size:12px;
  padding:4px 8px;
  border-radius:20px;
  display:none;
  animation:pulse 1.5s infinite;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.15)}
  100%{transform:scale(1)}
}

/* SKELETON */
.skeleton{
  background:linear-gradient(90deg,#e2e8f0 25%,#f1f5f9 50%,#e2e8f0 75%);
  background-size:200% 100%;
  animation:loading 1.2s infinite;
  border-radius:14px;
  height:140px;
}

@keyframes loading{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}

footer{
  text-align:center;
  padding:20px;
  font-size:12px;
  color:#64748b;
}
</style>
</head>

<body>

<header>
<button class="logout-btn" onclick="logout()">Sair</button>
<h1>üöö Painel Operacional Log√≠stico</h1>
<p>Central unificada dos sistemas</p>
<p id="usuarioLogado" style="margin-top:8px;font-size:13px;opacity:.9;"></p>
</header>

<main>

<!-- Skeleton Loading -->
<div id="skeletonContainer" class="cards">
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
</div>

<!-- Cards reais -->
<div class="cards" id="cardsContainer" style="display:none;">

<a class="card" href="frete.html" id="cardFrete" style="display:none;">
<div class="icon">üßÆ</div>
<div class="title">C√°lculo de Frete</div>
<div class="desc">Frete por rota otimizada</div>
</a>

<a class="card" href="index.html" id="cardPainelFila" style="display:none;">
<div class="icon">üéõÔ∏è</div>
<div class="title">Painel da Fila</div>
<div class="desc">Controle operacional</div>
</a>

<a class="card" href="clientes-admin.html" id="cardClientes" style="display:none;">
<div class="icon">üóÇÔ∏è</div>
<div class="title">Administra√ß√£o Clientes</div>
<div class="desc">Gest√£o e manuten√ß√£o</div>
</a>

<a class="card" href="coordenadas-invalidas.html" id="cardCoordenadas" style="display:none;">
<div class="icon">üß≠</div>
<div class="title">Revisar Coordenadas</div>
<div class="desc">Corre√ß√£o autom√°tica e manual</div>
<div id="badgeCoords" class="badge-alerta">0</div>
</a>

<a class="card" href="usuarios-admin.html" id="cardUsuarios" style="display:none;">
<div class="icon">üë§</div>
<div class="title">Controle Usu√°rios</div>
<div class="desc">Gest√£o de acessos</div>
</a>

</div>

</main>

<footer>
2026 ¬∑ Sistema Operacional Log√≠stico - ¬© Renato Monteiro
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCKdfOvWehaJcuK6uX5JXxc7YdN26h8sXY",
  authDomain:"tabela-frete-rio-branco.firebaseapp.com",
  projectId:"tabela-frete-rio-branco"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user)=>{

  if(!user){
    window.location.href="login.html";
    return;
  }

  const snap = await getDoc(doc(db,"usuarios",user.uid));

  if(!snap.exists()){
    window.location.href="login.html";
    return;
  }

  const dados = snap.data();

  document.getElementById("usuarioLogado").innerText =
    "Usu√°rio: "+dados.nome+" ("+dados.perfil.toUpperCase()+")";

  /* LIBERA MENUS */
  if(dados.menus?.frete) document.getElementById("cardFrete").style.display="block";
  if(dados.menus?.painel) document.getElementById("cardPainelFila").style.display="block";
  if(dados.menus?.clientes) document.getElementById("cardClientes").style.display="block";
  if(dados.menus?.usuarios) document.getElementById("cardUsuarios").style.display="block";

  if(dados.perfil==="admin"){
    document.getElementById("cardCoordenadas").style.display="block";
    await contarInvalidos();
  }

  /* REMOVE SKELETON */
  document.getElementById("skeletonContainer").style.display="none";
  const cards = document.getElementById("cardsContainer");
  cards.style.display="grid";
  setTimeout(()=>cards.classList.add("loaded"),50);
});

async function contarInvalidos(){
  const snapshot = await getDocs(collection(db,"clientes"));

  let invalidos=0;
  snapshot.forEach(docSnap=>{
    const d = docSnap.data();
    if(!d.latitude || !d.longitude) invalidos++;
  });

  if(invalidos>0){
    const badge = document.getElementById("badgeCoords");
    badge.innerText=invalidos;
    badge.style.display="block";
  }
}

window.logout = function(){
  signOut(auth).then(()=>window.location.href="login.html");
}
</script>

</body>
</html>

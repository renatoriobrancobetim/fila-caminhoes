<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Disponibilidade | Motorista</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0A3D91">

<style>
:root{
  --azul:#0A3D91;
  --verde:#28a745;
  --vermelho:#dc3545;
  --cinza:#f4f6f9;
}

body{
  margin:0;
  font-family:'Segoe UI',Arial,sans-serif;
  background:linear-gradient(180deg,#0A3D91,#062b66);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.app{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:24px;
  padding:28px;
  box-shadow:0 20px 50px rgba(0,0,0,.35);
}

.logo{
  text-align:center;
  color:var(--azul);
  font-weight:700;
  font-size:20px;
  margin-bottom:20px;
}

.status-box{
  text-align:center;
  margin-bottom:20px;
  padding:16px;
  border-radius:14px;
  font-weight:bold;
  font-size:18px;
}

.status-box.disponivel{
  background:#e6f4ea;
  color:var(--verde);
}

.status-box.indisponivel{
  background:#fdecea;
  color:var(--vermelho);
}

input{
  width:100%;
  padding:16px;
  margin-bottom:14px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:16px;
  text-transform:uppercase;
}

button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  margin-bottom:12px;
}

.btn-disponivel{
  background:var(--verde);
  color:#fff;
}

.btn-indisponivel{
  background:var(--vermelho);
  color:#fff;
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.feedback{
  text-align:center;
  min-height:30px;
  font-size:14px;
  margin-top:10px;
}

.spinner{
  width:30px;
  height:30px;
  border:4px solid #eee;
  border-top:4px solid var(--azul);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin{to{transform:rotate(360deg)}}

footer{
  text-align:center;
  margin-top:16px;
  font-size:12px;
  color:#777;
}
</style>
</head>

<body>

<div class="app">

  <div class="logo">üöö Motorista Rio Branco</div>

  <div id="statusAtual" class="status-box indisponivel">
    Status: INDISPON√çVEL
  </div>

  <input id="placa" placeholder="Placa do Caminh√£o"
    oninput="this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,'')">

  <input id="senha" type="password" placeholder="Senha">

  <button class="btn-disponivel" onclick="enviar('DISPON√çVEL')">
    ‚úÖ Estou Dispon√≠vel
  </button>

  <button class="btn-indisponivel" onclick="enviar('INDISPON√çVEL')">
    ‚ùå Ficar Indispon√≠vel
  </button>

  <div class="feedback" id="feedback"></div>

  <footer>
    ¬© 2026 ‚Ä¢ ERP Log√≠stico
  </footer>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  doc, 
  setDoc, 
  deleteDoc,
  getDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCKdfOvWehaJcuK6uX5JXxc7YdN26h8sXY",
  authDomain: "tabela-frete-rio-branco.firebaseapp.com",
  projectId: "tabela-frete-rio-branco"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const feedback = document.getElementById("feedback");
const statusBox = document.getElementById("statusAtual");

function setLoading(v){
  document.querySelectorAll("button").forEach(b=>b.disabled=v);
}

window.enviar = async function(status){

  const placa = document.getElementById("placa").value.trim().toUpperCase();
  const senha = document.getElementById("senha").value.trim();

  if(!placa || !senha){
    feedback.innerHTML="‚ö†Ô∏è Informe placa e senha";
    return;
  }

  setLoading(true);
  feedback.innerHTML='<div class="spinner"></div>';

  try{

    const snap = await getDoc(doc(db,"motoristas_cadastro",placa));

    if(!snap.exists()){
      feedback.innerHTML="‚ùå Placa n√£o cadastrada";
      setLoading(false);
      return;
    }

    const dados = snap.data();

    if(!dados.ativo){
      feedback.innerHTML="‚ùå Motorista inativo";
      setLoading(false);
      return;
    }

    if(dados.senha !== senha){
      feedback.innerHTML="‚ùå Senha incorreta";
      setLoading(false);
      return;
    }

    if(status==="INDISPON√çVEL"){
      await deleteDoc(doc(db,"fila",placa));
    }

    await setDoc(doc(db,"motoristas",placa),{
      placa,
      nome:dados.nome,
      configEixos:dados.configEixos||null,
      status,
      atualizadoEm:serverTimestamp()
    });

    statusBox.className="status-box "+(status==="DISPON√çVEL"?"disponivel":"indisponivel");
    statusBox.innerHTML="Status: "+status;

    feedback.innerHTML="‚úÖ Atualizado com sucesso";

    setTimeout(()=>feedback.innerHTML="",1500);

  }catch(e){
    feedback.innerHTML="‚ùå "+e.message;
  }

  setLoading(false);
};

</script>

</body>
</html>

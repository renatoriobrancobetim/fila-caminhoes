<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Usuários</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; padding: 20px; background: #f4f6f9; }
.card { background: #fff; padding: 20px; border-radius: 10px; max-width: 500px; }
input, select { width: 100%; padding: 8px; margin-bottom: 10px; }
button { padding: 10px; background: #1e3a8a; color: white; border: none; }
</style>
</head>

<body>

<div class="card">
<h2>Novo Usuário</h2>

<input type="text" id="nome" placeholder="Nome completo">
<input type="email" id="email" placeholder="Email">
<input type="password" id="senha" placeholder="Senha">

<label>Perfil</label>
<select id="perfil">
  <option value="vendedor">Vendedor</option>
  <option value="admin">Administrador</option>
</select>

<h4>Permissões</h4>
<label><input type="checkbox" id="menuPainel"> Painel</label><br>
<label><input type="checkbox" id="menuFrete"> Frete</label><br>
<label><input type="checkbox" id="menuClientes"> Clientes</label><br>
<label><input type="checkbox" id="menuUsuarios"> Usuários</label><br><br>

<button onclick="criarUsuario()">Criar Usuário</button>

<div id="msg"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCKdfOvWehaJcuK6uX5JXxc7YdN26h8sXY",
  authDomain: "tabela-frete-rio-branco.firebaseapp.com",
  projectId: "tabela-frete-rio-branco",
  storageBucket: "tabela-frete-rio-branco.firebasestorage.app",
  messagingSenderId: "765019849831",
  appId: "1:765019849831:web:f2089ab12a3eb7ea6880c2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Esconde página até validar
document.documentElement.style.display = "none";

onAuthStateChanged(auth, async (user) => {

  if (!user) {
    window.location.replace("login.html");
    return;
  }

  const userRef = doc(db, "usuarios", user.uid);
  const userSnap = await getDoc(userRef);

  if (!userSnap.exists()) {
    window.location.replace("painel.html");
    return;
  }

  const dados = userSnap.data();

  if (dados.perfil !== "admin" || !dados.ativo) {
    window.location.replace("painel.html");
    return;
  }

  // Se chegou aqui → é admin
  document.documentElement.style.display = "block";

});

</script>


</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Fila de Caminh√µes | Rio Branco</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0A3D91;
  color:#fff;
}
header{
  background:#0A3D91;
  padding:20px;
  border-bottom:6px solid #D71920;
  text-align:center;
}
h1{margin:0;}
.container{padding:20px;}

.cards{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-bottom:20px;
}

.card{
  padding:20px;
  border-radius:10px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

.proximo{background:#D71920;}
.ultimo{background:#1E90FF;}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  color:#000;
}
th,td{
  padding:12px;
  border:1px solid #ddd;
  text-align:center;
}
th{
  background:#0A3D91;
  color:#fff;
}
tr:first-child{
  background:#FFF3CD;
  font-weight:bold;
}

.status{
  text-align:center;
  margin-top:10px;
  font-size:12px;
  opacity:0.8;
}

@media(max-width:768px){
  .cards{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<header>
  <h1>Rio Branco Distribuidora de Combust√≠veis</h1>
  <p>Fila de Espera de Caminh√µes</p>
</header>

<div class="container">

  <div class="cards">
    <div class="card proximo" id="proximo">Carregando...</div>
    <div class="card ultimo" id="ultimo">√öltimo chamado: --</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Ordem</th>
        <th>Placa</th>
        <th>Compartimento</th>
        <th>Data</th>
        <th>Hora</th>
      </tr>
    </thead>
    <tbody id="fila"></tbody>
  </table>

  <div class="status" id="status">√öltima atualiza√ß√£o: --</div>
</div>

<script>
const URL_FILA = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRpTNysgwTFGT-r19Vxbrtd0zWMJz8LbJ5JVWTaUCtP4ExpJzNXHvsPDs3v6ThYbMo2OifA4oNY7op9/pub?gid=0&single=true&output=csv";
const URL_HIST = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRpTNysgwTFGT-r19Vxbrtd0zWMJz8LbJ5JVWTaUCtP4ExpJzNXHvsPDs3v6ThYbMo2OifA4oNY7op9/pub?gid=864994074&single=true&output=csv";

async function carregarFila(){
  try{
    const url = URL_FILA + "&nocache=" + Date.now();
    const res = await fetch(url, { cache:"no-store" });
    const texto = await res.text();

    const linhas = texto.trim().split("\n").slice(1);
    const tbody = document.getElementById("fila");
    const proximo = document.getElementById("proximo");

    tbody.innerHTML = "";

    if(linhas.length === 0){
      proximo.textContent = "Fila vazia";
    } else {
      linhas.forEach(l=>{
        const c = l.split(",");
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c[0]}</td>
          <td>${c[1]}</td>
          <td>${c[2]}</td>
          <td>${c[3]}</td>
          <td>${c[4]}</td>
        `;
        tbody.appendChild(tr);
      });

      proximo.textContent =
        "üîî Pr√≥ximo: " + linhas[0].split(",")[1] +
        " ‚Ä¢ Comp. " + linhas[0].split(",")[2];
    }

    document.getElementById("status").textContent =
      "√öltima atualiza√ß√£o: " + new Date().toLocaleTimeString();

  }catch(e){
    console.error("Erro fila");
  }
}

async function carregarUltimoChamado(){
  try{
    const url = URL_HIST + "&nocache=" + Date.now();
    const res = await fetch(url, { cache:"no-store" });
    const texto = await res.text();

    const linhas = texto.trim().split("\n").slice(1);
    const ultimo = document.getElementById("ultimo");

    if(linhas.length === 0){
      ultimo.textContent = "√öltimo chamado: --";
      return;
    }

    const ultimaLinha = linhas[linhas.length - 1].split(",");

    ultimo.textContent =
      "√öltimo chamado: " + ultimaLinha[0] +
      " ‚Ä¢ Comp. " + ultimaLinha[1];

  }catch(e){
    console.error("Erro hist√≥rico");
  }
}

// üöÄ CARGA INICIAL
carregarFila();
carregarUltimoChamado();

// üîÑ ATUALIZA√á√ÉO R√ÅPIDA
setInterval(()=>{
  carregarFila();
  carregarUltimoChamado();
}, 3000);
</script>

</body>
</html>

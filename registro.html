<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Registrar Comprovante</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0A3D91">

<!-- iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Comprovantes RB">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0A3D91;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.container{
  width:100%;
  max-width:440px;
  background:#fff;
  border-radius:16px;
  padding:26px;
  box-shadow:0 15px 35px rgba(0,0,0,.3);
}

h2{
  text-align:center;
  margin:0;
}

.sub{
  text-align:center;
  font-size:14px;
  opacity:.7;
  margin-bottom:20px;
}

.field{
  margin-bottom:16px;
}

label{
  font-size:13px;
  font-weight:bold;
  display:block;
  margin-bottom:6px;
}

input{
  width:100%;
  padding:16px;
  font-size:18px;
  border-radius:12px;
  border:1px solid #ccc;
  outline:none;
}

input:focus{
  border-color:#0A3D91;
  box-shadow:0 0 0 2px rgba(10,61,145,.2);
}

button{
  width:100%;
  padding:16px;
  font-size:18px;
  background:#D71920;
  color:#fff;
  border:none;
  border-radius:14px;
  font-weight:bold;
  cursor:pointer;
}

button:active{
  transform:scale(.98);
}

#msg{
  margin-top:15px;
  text-align:center;
  font-weight:bold;
}

/* PREVIEW */
#preview{
  margin-top:10px;
  display:none;
  text-align:center;
}
#preview img{
  max-width:100%;
  border-radius:12px;
  border:2px solid #0A3D91;
}

/* SUCESSO */
.sucesso{
  animation:sucesso 0.8s ease;
  color:green;
}
@keyframes sucesso{
  0%{transform:scale(0.9); opacity:0}
  100%{transform:scale(1); opacity:1}
}

footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  margin-top:18px;
}
</style>
</head>

<body>

<div class="container">
  <h2>üì∏ Registrar Comprovante</h2>
  <div class="sub">Envio de canhoto de entrega</div>

  <div class="field">
    <label>üßæ Nota Fiscal</label>
    <input id="nota"
      placeholder="Somente n√∫meros"
      inputmode="numeric"
      pattern="[0-9]*"
      oninput="this.value=this.value.replace(/\D/g,'')">
  </div>

  <div class="field">
    <label>üë§ Motorista</label>
    <input id="motorista" placeholder="Nome do motorista">
  </div>

  <div class="field">
    <label>üöö Placa</label>
    <input id="placa" placeholder="Placa do caminh√£o">
  </div>

  <div class="field">
    <label>üîê Senha</label>
    <input id="senha" type="password" placeholder="Senha">
  </div>

  <div class="field">
    <label>üì∑ Foto do canhoto</label>
    <input id="foto" type="file" accept="image/*" capture="camera" onchange="mostrarPreview()">
  </div>

  <div id="preview">
    <p><b>Pr√©-visualiza√ß√£o:</b></p>
    <img id="imgPreview">
  </div>

  <button onclick="enviar()">Enviar comprovante</button>

  <div id="msg"></div>

  <footer>
    ¬© <span id="ano"></span> ¬∑ Copywriter Renato Monteiro
  </footer>
</div>

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycby_xvyg5C6-rPwy1a0HemVTysmSHKywolZiwFaXtwKniq7Aphg8s3Tk_tXDwkV0bXvB/exec";

document.getElementById("ano").textContent = new Date().getFullYear();

/* PREVIEW */
function mostrarPreview(){
  const file = foto.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = ()=>{
    imgPreview.src = reader.result;
    preview.style.display="block";
  };
  reader.readAsDataURL(file);
}

function enviar(){
  const msg = document.getElementById("msg");
  const file = foto.files[0];

  if(!nota.value || !senha.value){
    msg.textContent="‚ö†Ô∏è Informe NF e senha";
    msg.style.color="red";
    return;
  }

  if(!file){
    msg.textContent="‚ö†Ô∏è Tire a foto do canhoto";
    msg.style.color="red";
    return;
  }

  msg.textContent="‚è≥ Enviando comprovante...";
  msg.style.color="#333";

  const reader = new FileReader();
  reader.onload = ()=>{
    fetch(SCRIPT_URL,{
      method:"POST",
      body:new URLSearchParams({
        acao:"enviar",
        nota:nota.value,
        motorista:motorista.value,
        placa:placa.value,
        senha:senha.value,
        imagem:reader.result
      })
    })
    .then(r=>r.text())
    .then(t=>{
      msg.textContent=t;
      msg.className = t.startsWith("‚úÖ") ? "sucesso" : "";
      msg.style.color = t.startsWith("‚úÖ") ? "green" : "red";

      if(t.startsWith("‚úÖ")){
        nota.value="";
        motorista.value="";
        placa.value="";
        senha.value="";
        foto.value="";
        preview.style.display="none";
      }
    })
    .catch(()=>{
      msg.textContent="‚ùå Erro de conex√£o";
      msg.style.color="red";
    });
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
